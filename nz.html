
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.js" charset="utf-8"></script>
     <script src="uk.js" charset="utf-8"></script>
     <script src="http://cdnjs.cloudflare.com/ajax/libs/topojson/1.1.0/topojson.min.js" charset="utf-8"></script>
    <script src="PopulationData.js" charset="utf-8"></script>
    <title></title>
</head>
<body>
    <style>
        div svg{
            margin-left:auto;
            margin-right:auto;
            display:block;
        }
        
        .focus {
            opacity: 1;
        }
        
        .unFocus {
            opacity: 0.5;
        }
    </style>
    
    <script>
         $('document').ready(function(){
     //Width and height
            var w = 1000;
            var h = 1000;
             
             var maxColor = "#000A00";
             var minColor = "#99C299";
             
             var cLat = -180;
             var cLong = 41;
             
             var transition = 1000;
             var scale = 3200;

            //Define map projection
            var projection = d3.geo.equirectangular()  
							    .scale(scale)
							    .translate([w/2 + (w/8),h/2 - (h/12)])
							    .rotate([-180,41]);

            //Define path generator
            var path = d3.geo.path()
                             .projection(projection);

            //Create SVG element
            var svg = d3.select("#map_area")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);    
        
       /*var color = d3.scale.ordinal()
                      .domain([0, d3.max(popInfo2001)])
                      .range("#000000", "#00FF00");
        */
        
       var regions = ["North Land", "Auckland", "Waikato", "Bay of Plenty", "Gisbourne", "Hawkes Bay", "Wanganui", "Manuatu", "Wellington", "West Coast", "Canterbury", "Otago", "Southland", "Nelson", "Tasman", "Malbouragh"];
       var popData = getPopData(popInfo2001);
  
        
        var scale = d3.scale.linear()
                    .domain([d3.min(popData), d3.max(popData)])
                    .range([minColor, maxColor]);
             
             var zoomed = false;
       
        
        
        
        nzg = topojson.feature(nz, nz.objects['nz-regional-councils-census'])

                //Bind data and create one path per GeoJSON feature
                svg.selectAll("path")
                   .data(nzg.features)
                   .enter()
                   .append("path")
                   .attr("d", path)
                   .style("fill", function(d, i) {   
                        return scale(popData[i]);
                    })
                    .style("opacity", function(d, i) {
                        return "rgba(0, 255, 0, " + 1 / i + ")";
                    })
                   .style("text", function(d, i) {
                   	return i;
                   })
                    .attr("id", function(d, i) {
                        return regions[i];
                    })
                   .on("mouseover", function(d) {
                        if(zoomed == false) {
                            d3.select(this).style("opacity", 0.6);
                        }
                    })
                   .on("mouseout", function(d) {
                        if(zoomed == false) {
                            d3.select(this).style("opacity", 1);
                        }
			        })
                    .on("click", function(d){
                        zoomed = true;
                        var cords = d3.geo.centroid(d);
                        console.log(d3.selectAll("this"));
                        drawMap(cords[0], cords[1], 7200)
                        d3.selectAll("path").style("opacity", 0.5);
                        d3.select(this).style("opacity", 1); 
                    });
        
        //-------------------------------------- Functions =========================
        function drawMap(xCord, yCord, scale) {
            projection.rotate([xCord * -1,  yCord * -1])
                    .scale(scale);
            
            svg.selectAll("path")
            .attr("d", path);
            
        }
             
        function updateMap() {
  
        
            scale = d3.scale.linear()
                        .domain([d3.min(popData), d3.max(popData)])
                        .range([minColor, maxColor]);
            
            svg.selectAll("path")            
            .transition().duration(transition)
            .style("fill", function(d, i) {   
                        return scale(popData[i]);
                    });
            
        }
        
        
       
            
            $('#year_select').on('change', function() {
                var selected = $("#year_select").val();
                if(selected == "2001") {
                    popData = getPopData(popInfo2001);
                }                 
                else {
                    popData = getPopData(popInfo2006);
                }
                updateMap();
            })
        /*
         * Returns an array with population count.
         */
        function getPopData(yearArray) {
            var population = [];
        
            for(var i = 0; i < yearArray.length; i++) {
               population.push(yearArray[i].Population);
            }
            return population;
        }
         });
        
    </script>
    <select id="year_select">
        <option>2001</option>
        <option>2006</option>
    </select>
    <div id="map_area">
        
    </div>
</body>
</html>